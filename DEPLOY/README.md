# Деплой сайта (канонический процесс)

Этот проект публикуется ТОЛЬКО через GitHub Actions.

## Как выпустить релиз

1. Создайте тег на нужном коммите: `vYYYY.MM.DD-N` (пример: `v2025.10.28-1`).
2. Пуш тега запускает workflow `.github/workflows/deploy-canonical.yml`.
3. После завершения деплоя проверьте версию:
   - Откройте `https://phukeo.com/?v=<tag>&showBuild=1`
   - Откройте `https://phukeo.com/__build.txt` — там должен быть `commit=<sha>` и `ref=refs/tags/<tag>`.

## Ручной деплой (горячий фикс)

Запустите вручную workflow `Deploy (canonical)` и укажите `ref` (ветка/тег/SHA). Это соберёт и опубликует ровно указанный снапшот.

## Встроенные проверки

- CI падает, если:
  - в `dist` обнаружен вложенный `.git`;
  - размер `dist` превышает 2.5 ГБ.
- В `dist/__build.txt` пишется маркер сборки (sha/ref/date/repo).

## Откат

Запустите ручной деплой на предыдущий тег: `ref=refs/tags/<prev-tag>`.

## Почему так надёжно

- Один источник истины — GitHub Actions.
- Релиз фиксируется тегом → всегда понятно, какой код на проде.
- Маркер `__build.txt` даёт прозрачную верификацию версии.

## Превью без влияния на прод

Рекомендуется публиковать превью для PR в отдельные окружения (например, Vercel/Netlify) или в подпапку Pages. Прод — только по тегам.
