// ü§ñ Telegram Bot - Welcome Message –¥–ª—è –ü—Ö—É–∫–µ—Ç Go
// –§–∞–π–ª: bot/welcome-message-v2.js

const { Telegraf, Markup } = require('telegraf');
require('dotenv').config();
const { tours, categories } = require('./tours-data');

const bot = new Telegraf(process.env.BOT_TOKEN);

// üíæ –•–†–ê–ù–ò–õ–ò–©–ï –°–ï–°–°–ò–ô (–¥–ª—è –¥–∏–∞–ª–æ–≥–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
const sessions = {};

// üìä –ê–ù–ê–õ–ò–¢–ò–ö–ê –ì–†–£–ü–ü–´
const groupStats = {
  messages: 0,
  tourMentions: {
    'Maya Bay': 0,
    'Phi Phi': 0,
    'James Bond': 0,
    'Similan': 0,
    'Bamboo Island': 0,
    'Coral Island': 0,
    'Banana Beach': 0,
    'Racha Island': 0,
    'Khai Islands': 0,
    'Promthep Cape': 0,
    'Cheow Lan Lake': 0
  },
  users: new Set(),
  questions: 0,
  lastReset: new Date()
};

// –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
const keywords = {
  questions: ['—Ü–µ–Ω–∞', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', '—Å–∫–æ–ª—å–∫–æ', '–∫–æ–≥–¥–∞', '–≥–¥–µ', '–∫–∞–∫ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', 'booking'],
  tours: {
    'Maya Bay': ['maya', '–º–∞–π—è', '–±—É—Ö—Ç–∞ –º–∞–π—è', '–º–∞—è –±–µ–π'],
    'Phi Phi': ['phi phi', '–ø—Ö–∏ –ø—Ö–∏', '—Ñ–∏ —Ñ–∏'],
    'James Bond': ['james', '–¥–∂–µ–π–º—Å', '–±–æ–Ω–¥', '–¥–∂–µ–π–º—Å –±–æ–Ω–¥'],
    'Similan': ['similan', '—Å–∏–º–∏–ª–∞–Ω'],
    'Bamboo Island': ['bamboo', '–±–∞–º–±—É–∫'],
    'Coral Island': ['coral', '–∫–æ—Ä–∞–ª–ª'],
    'Banana Beach': ['banana', '–±–∞–Ω–∞–Ω'],
    'Racha Island': ['racha', '—Ä–∞—á–∞'],
    'Khai Islands': ['khai', '–∫—Ö–∞–π'],
    'Promthep Cape': ['promthep', '–ø—Ä–æ–º—Ç–µ–ø'],
    'Cheow Lan Lake': ['cheow lan', '—á–µ–æ –ª–∞–Ω', '–æ–∑–µ—Ä–æ']
  }
};

// üéØ –ö–û–ú–ê–ù–î–ê /start
bot.start(async (ctx) => {
  const firstName = ctx.from.first_name || '–¥—Ä—É–≥';
  const chatType = ctx.chat.type;
  
  // üîó DEEP LINK: –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–∑ /start [–ø–∞—Ä–∞–º–µ—Ç—Ä]
  const startParam = ctx.message.text.split(' ')[1];
  
  console.log('üìù START:', ctx.message.text, '| –ü–∞—Ä–∞–º–µ—Ç—Ä:', startParam);
  
  // üîó DEEP LINKS –î–õ–Ø –í–°–ï–• –¢–£–†–û–í
  
  // 1Ô∏è‚É£ –ü–•–ò-–ü–•–ò 2 –î–ù–Ø/1 –ù–û–ß–¨
  if (startParam === 'phiphi2days') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/phiphi-main.jpg',
      {
        caption: 
          `ÔøΩÔ∏è –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –ü—Ö–∏-–ü—Ö–∏ 2 –¥–Ω—è/1 –Ω–æ—á—å\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –ü—Ä–æ–∂–∏–≤–∞–Ω–∏–µ –≤ –æ—Ç–µ–ª–µ –Ω–∞ –ü—Ö–∏-–ü—Ö–∏\n` +
          `‚Ä¢ –ü–æ—Å–µ—â–µ–Ω–∏–µ –±—É—Ö—Ç—ã –ú–∞–π—è –ë—ç–π\n` +
          `‚Ä¢ –°–Ω–æ—Ä–∫–ª–∏–Ω–≥ –≤ –ª–∞–≥—É–Ω–∞—Ö\n` +
          `‚Ä¢ 2 –∑–∞–≤—Ç—Ä–∞–∫–∞ + 1 –æ–±–µ–¥ + 1 —É–∂–∏–Ω\n` +
          `‚Ä¢ –¢—Ä–∞–Ω—Å—Ñ–µ—Ä –æ—Ç –æ—Ç–µ–ª—è –∏ –æ–±—Ä–∞—Ç–Ω–æ\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: –æ—Ç 6500‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): –æ—Ç 5500‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/phi-phi-2days' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 2Ô∏è‚É£ 4 –ñ–ï–ú–ß–£–ñ–ò–ù–´ –ê–ù–î–ê–ú–ê–ù–°–ö–û–ì–û –ú–û–†–Ø
  if (startParam === 'pearls') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/pearls-main.jpg',
      {
        caption: 
          `üíé –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: 4 –∂–µ–º—á—É–∂–∏–Ω—ã –ê–Ω–¥–∞–º–∞–Ω—Å–∫–æ–≥–æ –º–æ—Ä—è\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –ü—Ö–∏-–ü—Ö–∏ + –î–∂–µ–π–º—Å –ë–æ–Ω–¥ + –ö—Ä–∞–±–∏ + –†–∞—è–ª–∏\n` +
          `‚Ä¢ 2 –¥–Ω—è, 1 –Ω–æ—á—å\n` +
          `‚Ä¢ –ö–æ–º–±–æ-—Ç—É—Ä –ø–æ –ª—É—á—à–∏–º –º–µ—Å—Ç–∞–º\n` +
          `‚Ä¢ –ü—Ä–æ–∂–∏–≤–∞–Ω–∏–µ + –≤—Å–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—ã\n` +
          `‚Ä¢ –ü–∏—Ç–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: –æ—Ç 8500‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): –æ—Ç 7000‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/pearls-andaman-sea' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 3Ô∏è‚É£ –î–û–°–¢–û–ü–†–ò–ú–ï–ß–ê–¢–ï–õ–¨–ù–û–°–¢–ò –ü–•–£–ö–ï–¢–ê
  if (startParam === 'sightseeing') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/bigbuddha-main.jpg',
      {
        caption: 
          `üõï –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ü—Ö—É–∫–µ—Ç–∞\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –ë–æ–ª—å—à–æ–π –ë—É–¥–¥–∞ (45 –º–µ—Ç—Ä–æ–≤!)\n` +
          `‚Ä¢ –•—Ä–∞–º –í–∞—Ç –ß–∞–ª–æ–Ω–≥\n` +
          `‚Ä¢ –°—Ç–∞—Ä—ã–π –≥–æ—Ä–æ–¥ –ü—Ö—É–∫–µ—Ç–∞\n` +
          `‚Ä¢ –ú—ã—Å –ü—Ä–æ–º—Ç–µ–ø (–∑–∞–∫–∞—Ç)\n` +
          `‚Ä¢ –°–º–æ—Ç—Ä–æ–≤—ã–µ –ø–ª–æ—â–∞–¥–∫–∏\n` +
          `‚Ä¢ –û–±–µ–¥ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 1800‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 1200‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/dostoprimechatelnosti-phuketa' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 4Ô∏è‚É£ –†–ê–§–¢–ò–ù–ì + –°–ü–ê + ATV
  if (startParam === 'rafting') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/rafting-scaled-BRXUzIbt.jpg',
      {
        caption: 
          `üåä –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –†–∞—Ñ—Ç–∏–Ω–≥ + –°–ü–ê + ATV\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –†–∞—Ñ—Ç–∏–Ω–≥ 5 –∫–º –ø–æ –≥–æ—Ä–Ω–æ–π —Ä–µ–∫–µ\n` +
          `‚Ä¢ –°–ü–ê –º–∞—Å—Å–∞–∂ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã\n` +
          `‚Ä¢ ATV –∫–≤–∞–¥—Ä–æ—Ü–∏–∫–ª—ã (1 —á–∞—Å)\n` +
          `‚Ä¢ –û–±–µ–¥ –∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –æ—Ç –æ—Ç–µ–ª—è\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 2500‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 1800‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–ª–æ–≤–µ–∫! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/rafting-spa-atv' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 5Ô∏è‚É£ –†–ê–§–¢–ò–ù–ì + –°–ü–ê (1 –î–ï–ù–¨)
  if (startParam === 'raftingspa') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/rafting-spa.jpg',
      {
        caption: 
          `üåä –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –†–∞—Ñ—Ç–∏–Ω–≥ + –°–ü–ê (1 –¥–µ–Ω—å)\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –†–∞—Ñ—Ç–∏–Ω–≥ 5 –∫–º\n` +
          `‚Ä¢ –°–ü–ê-–º–∞—Å—Å–∞–∂ 1,5 —á–∞—Å–∞\n` +
          `‚Ä¢ –û–±–µ–¥ –∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 2200‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 1600‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/rafting-spa-1day' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 6Ô∏è‚É£ –ö–ê–û –õ–ê–ö –°–ê–§–ê–†–ò
  if (startParam === 'kaolak') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/kaolak-main.jpg',
      {
        caption: 
          `ÔøΩ –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –ö–∞–æ –õ–∞–∫ –°–∞—Ñ–∞—Ä–∏\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –ö–∞—Ç–∞–Ω–∏–µ –Ω–∞ —Å–ª–æ–Ω–∞—Ö\n` +
          `‚Ä¢ –ë–∞–º–±—É–∫–æ–≤—ã–µ –ø–ª–æ—Ç—ã\n` +
          `‚Ä¢ –í–æ–¥–æ–ø–∞–¥—ã\n` +
          `‚Ä¢ –î–∂—É–Ω–≥–ª–∏\n` +
          `‚Ä¢ –û–±–µ–¥ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 2400‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 1700‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/kao-lak-safari' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 7Ô∏è‚É£ 11 –û–°–¢–†–û–í–û–í –ú–ï–ì–ê-–¢–£–†
  if (startParam === '11islands') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/11islands-main.jpg',
      {
        caption: 
          `üèùÔ∏è –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: 11 –æ—Å—Ç—Ä–æ–≤–æ–≤ –∑–∞ 1 –¥–µ–Ω—å!\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ 11 –æ—Å—Ç—Ä–æ–≤–æ–≤ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–π –ª–æ–¥–∫–µ\n` +
          `‚Ä¢ –°–Ω–æ—Ä–∫–ª–∏–Ω–≥ –≤ –ª—É—á—à–∏—Ö –º–µ—Å—Ç–∞—Ö\n` +
          `‚Ä¢ –û–±–µ–¥ –Ω–∞ –ø–ª—è–∂–µ\n` +
          `‚Ä¢ –ü–æ–ª–Ω—ã–π –¥–µ–Ω—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 3500‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 2800‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/eleven-islands-mega' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 8Ô∏è‚É£ –î–ñ–ï–ô–ú–° –ë–û–ù–î + –ü–•–ê–ù–ì –ù–ì–ê
  if (startParam === 'jamesbond') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/jamesbond-main.jpg',
      {
        caption: 
          `üé¨ –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –î–∂–µ–π–º—Å –ë–æ–Ω–¥ + –ü—Ö–∞–Ω–≥ –ù–≥–∞\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –û—Å—Ç—Ä–æ–≤ –î–∂–µ–π–º—Å–∞ –ë–æ–Ω–¥–∞ (–∏–∑ —Ñ–∏–ª—å–º–∞!)\n` +
          `‚Ä¢ –ü–µ—â–µ—Ä—ã –ü—Ö–∞–Ω–≥ –ù–≥–∞\n` +
          `‚Ä¢ –ö–∞–Ω–æ—ç –ø–æ –º–∞–Ω–≥—Ä–æ–≤—ã–º –ª–µ—Å–∞–º\n` +
          `‚Ä¢ –ú—É—Å—É–ª—å–º–∞–Ω—Å–∫–∞—è –¥–µ—Ä–µ–≤–Ω—è\n` +
          `‚Ä¢ –û–±–µ–¥ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 2300‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 1600‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/james-bond-island' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 9Ô∏è‚É£ –û–ó–ï–†–û –ß–ï–û –õ–ê–ù (–ê–í–ê–¢–ê–†)
  if (startParam === 'cheolan' || startParam === 'avatar') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/cheolan-main.jpg',
      {
        caption: 
          `üèûÔ∏è –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –û–∑–µ—Ä–æ –ß–µ–æ –õ–∞–Ω (–ê–≤–∞—Ç–∞—Ä)\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –ü–ª–∞–≤—É—á–∏–µ –±—É–Ω–≥–∞–ª–æ –Ω–∞ –æ–∑–µ—Ä–µ\n` +
          `‚Ä¢ –ö–∞—è–∫–∏–Ω–≥ –º–µ–∂–¥—É —Å–∫–∞–ª–∞–º–∏\n` +
          `‚Ä¢ –î–∂—É–Ω–≥–ª–∏ –∏ –≤–æ–¥–æ–ø–∞–¥—ã\n` +
          `‚Ä¢ –ü–ª–æ—Ç –ø–æ –æ–∑–µ—Ä—É\n` +
          `‚Ä¢ –ü–∏—Ç–∞–Ω–∏–µ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 2900‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 2200‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/cheow-lan-lake' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 9Ô∏è‚É£.5Ô∏è‚É£ –û–ó–ï–†–û –ß–ï–û –õ–ê–ù + –•–ê–ù–ì–î–û–ù–ì (–ê–í–ê–¢–ê–† –ü–õ–Æ–°)
  if (startParam === 'avatarplus' || startParam === 'hangdong') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/avatar-hangdong.jpg',
      {
        caption: 
          `üèûÔ∏è –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –û–∑–µ—Ä–æ –ß–µ–æ –õ–∞–Ω + –•–∞–Ω–≥–¥–æ–Ω–≥\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –û–∑–µ—Ä–æ –ß–µ–æ –õ–∞–Ω (–ê–≤–∞—Ç–∞—Ä)\n` +
          `‚Ä¢ –ü–µ—â–µ—Ä–∞ –•–∞–Ω–≥–¥–æ–Ω–≥\n` +
          `‚Ä¢ –ö–∞—è–∫–∏–Ω–≥\n` +
          `‚Ä¢ –ü–ª–∞–≤—É—á–∏–µ –±—É–Ω–≥–∞–ª–æ\n` +
          `‚Ä¢ –ü–∏—Ç–∞–Ω–∏–µ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 3200‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 2500‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/avatar-plus-hangdong' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // üîü –†–ê–ß–ê + –ö–û–†–ê–õ –û–°–¢–†–û–í–ê
  if (startParam === 'racha') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/racha-main.jpg',
      {
        caption: 
          `üèùÔ∏è –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –†–∞—á–∞ + –ö–æ—Ä–∞–ª –æ—Å—Ç—Ä–æ–≤–∞\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –û—Å—Ç—Ä–æ–≤ –†–∞—á–∞ (–±–µ–ª—ã–π –ø–µ—Å–æ–∫!)\n` +
          `‚Ä¢ –û—Å—Ç—Ä–æ–≤ –ö–æ—Ä–∞–ª (—Å–Ω–æ—Ä–∫–ª–∏–Ω–≥)\n` +
          `‚Ä¢ –û–±–µ–¥ –Ω–∞ –ø–ª—è–∂–µ\n` +
          `‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç–Ω–∞—è –ª–æ–¥–∫–∞\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 2100‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 1500‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/racha-coral-islands' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 1Ô∏è‚É£1Ô∏è‚É£ –ü–•–ê–ù–ì –ù–ì–ê –°–ö–ê–ô–í–û–ö
  if (startParam === 'skywalk') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/skywalk-main.jpg',
      {
        caption: 
          `üåâ –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –ü—Ö–∞–Ω–≥ –ù–≥–∞ –°–∫–∞–π–≤–æ–∫\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –°—Ç–µ–∫–ª—è–Ω–Ω—ã–π –º–æ—Å—Ç –Ω–∞–¥ –¥–∂—É–Ω–≥–ª—è–º–∏\n` +
          `‚Ä¢ –°–º–æ—Ç—Ä–æ–≤—ã–µ –ø–ª–æ—â–∞–¥–∫–∏\n` +
          `‚Ä¢ –í–æ–¥–æ–ø–∞–¥—ã\n` +
          `‚Ä¢ –û–±–µ–¥ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 1900‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 1400‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/phang-nga-skywalk' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 1Ô∏è‚É£2Ô∏è‚É£ –û–°–¢–†–û–í–ê –°–ò–ú–ò–õ–ê–ù
  if (startParam === 'similan') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/similan-main.jpg',
      {
        caption: 
          `üê† –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –û—Å—Ç—Ä–æ–≤–∞ –°–∏–º–∏–ª–∞–Ω\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –õ—É—á—à–∏–π —Å–Ω–æ—Ä–∫–ª–∏–Ω–≥ –≤ –¢–∞–∏–ª–∞–Ω–¥–µ!\n` +
          `‚Ä¢ –ë–µ–ª–æ—Å–Ω–µ–∂–Ω—ã–µ –ø–ª—è–∂–∏\n` +
          `‚Ä¢ –ß–µ—Ä–µ–ø–∞—Ö–∏ –∏ —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ —Ä—ã–±—ã\n` +
          `‚Ä¢ –û–±–µ–¥ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 2800‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 2200‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/similan-islands' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 1Ô∏è‚É£3Ô∏è‚É£ –°–ò–ú–ò–õ–ê–ù –†–ê–ù–ù–ò–ô –í–´–ï–ó–î
  if (startParam === 'similanearly') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/similan-early.jpg',
      {
        caption: 
          `üåÖ –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –°–∏–º–∏–ª–∞–Ω —Ä–∞–Ω–Ω–∏–π –≤—ã–µ–∑–¥\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –í—ã–µ–∑–¥ –≤ 4:00 - –ø–µ—Ä–≤—ã–µ –Ω–∞ –æ—Å—Ç—Ä–æ–≤–∞—Ö!\n` +
          `‚Ä¢ –ë–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å–Ω–æ—Ä–∫–ª–∏–Ω–≥\n` +
          `‚Ä¢ –ú–µ–Ω—å—à–µ —Ç—É—Ä–∏—Å—Ç–æ–≤\n` +
          `‚Ä¢ –û–±–µ–¥ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 3000‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 2400‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/similan-islands-early' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 1Ô∏è‚É£4Ô∏è‚É£ –°–ò–ú–ò–õ–ê–ù –°–ü–ò–î–ë–û–¢
  if (startParam === 'similanspeed') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/similan-speed.jpg',
      {
        caption: 
          `‚ö° –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –°–∏–º–∏–ª–∞–Ω –Ω–∞ —Å–ø–∏–¥–±–æ—Ç–µ\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç–Ω–∞—è –ª–æ–¥–∫–∞ (–±—ã—Å—Ç—Ä–µ–µ!)\n` +
          `‚Ä¢ –ú–µ–Ω—å—à–µ –≥—Ä—É–ø–ø–∞ = –±–æ–ª—å—à–µ –∫–æ–º—Ñ–æ—Ä—Ç–∞\n` +
          `‚Ä¢ –í—Å–µ –æ—Å—Ç—Ä–æ–≤–∞ –∑–∞ –¥–µ–Ω—å\n` +
          `‚Ä¢ –û–±–µ–¥ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 3200‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 2600‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/similan-islands-speedboat' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 1Ô∏è‚É£5Ô∏è‚É£ –†–´–ë–ê–õ–ö–ê –ù–ê –†–ê–°–°–í–ï–¢–ï
  if (startParam === 'fishing') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/fishing-main.jpg',
      {
        caption: 
          `üé£ –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –†—ã–±–∞–ª–∫–∞ –Ω–∞ —Ä–∞—Å—Å–≤–µ—Ç–µ\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –†—ã–±–∞–ª–∫–∞ –Ω–∞ —Ä–∞—Å—Å–≤–µ—Ç–µ (5:00-11:00)\n` +
          `‚Ä¢ –í—Å–µ —Å–Ω–∞—Å—Ç–∏ –∏ –Ω–∞–∂–∏–≤–∫–∞\n` +
          `‚Ä¢ –ü—Ä–∏–≥–æ—Ç–æ–≤–∏–º –≤–∞—à —É–ª–æ–≤!\n` +
          `‚Ä¢ –ó–∞–≤—Ç—Ä–∞–∫ –Ω–∞ –ª–æ–¥–∫–µ\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 1800‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 1200‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/fishing-sunrise' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 1Ô∏è‚É£6Ô∏è‚É£ –†–ê–ß–ê + –ö–û–†–ê–õ –†–ê–°–°–í–ï–¢
  if (startParam === 'rachasunrise') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/racha-sunrise.jpg',
      {
        caption: 
          `üåÖ –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –†–∞—á–∞ + –ö–æ—Ä–∞–ª —Ä–∞—Å—Å–≤–µ—Ç\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –†–∞–Ω–Ω–∏–π –≤—ã–µ–∑–¥ - –ø–µ—Ä–≤—ã–µ –Ω–∞ –æ—Å—Ç—Ä–æ–≤–∞—Ö!\n` +
          `‚Ä¢ –†–∞—Å—Å–≤–µ—Ç –Ω–∞ –ø–ª—è–∂–µ\n` +
          `‚Ä¢ –ë–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∫—É–ø–∞–Ω–∏—è\n` +
          `‚Ä¢ –ó–∞–≤—Ç—Ä–∞–∫ + –æ–±–µ–¥ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 2300‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 1700‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/racha-coral-sunrise' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 1Ô∏è‚É£7Ô∏è‚É£ –†–ê–ß–ê + –ö–û–†–ê–õ –†–ê–í–ê–ò
  if (startParam === 'racharawai') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/racha-rawai.jpg',
      {
        caption: 
          `üèñÔ∏è –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –†–∞—á–∞ + –ö–æ—Ä–∞–ª (–∏–∑ –†–∞–≤–∞–∏)\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –í—ã–µ–∑–¥ –∏–∑ –†–∞–≤–∞–∏ (–±–ª–∏–∂–µ –∫ –æ—Å—Ç—Ä–æ–≤–∞–º!)\n` +
          `‚Ä¢ –ú–µ–Ω—å—à–µ –≤ –ø—É—Ç–∏ = –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–ª—è–∂–µ\n` +
          `‚Ä¢ –°–Ω–æ—Ä–∫–ª–∏–Ω–≥\n` +
          `‚Ä¢ –û–±–µ–¥ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 2000‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 1400‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/racha-coral-rawai' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 1Ô∏è‚É£8Ô∏è‚É£ –ü–•–ò-–ü–•–ò –†–ê–°–°–í–ï–¢
  if (startParam === 'phiphisunrise') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/phiphi-sunrise.jpg',
      {
        caption: 
          `üåÖ –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –ü—Ö–∏-–ü—Ö–∏ —Ä–∞—Å—Å–≤–µ—Ç\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –í—ã–µ–∑–¥ –≤ 5:00 - –≤—Å—Ç—Ä–µ—á–∞–µ–º —Ä–∞—Å—Å–≤–µ—Ç!\n` +
          `‚Ä¢ –ú–∞–π—è –ë—ç–π –ë–ï–ó —Ç–æ–ª–ø —Ç—É—Ä–∏—Å—Ç–æ–≤\n` +
          `‚Ä¢ –°–Ω–æ—Ä–∫–ª–∏–Ω–≥ –≤ –ª–∞–≥—É–Ω–∞—Ö\n` +
          `‚Ä¢ –ó–∞–≤—Ç—Ä–∞–∫ + –æ–±–µ–¥ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 2600‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 2000‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/phi-phi-sunrise' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 1Ô∏è‚É£9Ô∏è‚É£ 5 –ñ–ï–ú–ß–£–ñ–ò–ù 2 –î–ù–Ø
  if (startParam === '5pearls') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/5pearls-main.jpg',
      {
        caption: 
          `üíé –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: 5 –∂–µ–º—á—É–∂–∏–Ω –∑–∞ 2 –¥–Ω—è\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ 5 –ª—É—á—à–∏—Ö –æ—Å—Ç—Ä–æ–≤–æ–≤\n` +
          `‚Ä¢ –ü—Ä–æ–∂–∏–≤–∞–Ω–∏–µ + –ø–∏—Ç–∞–Ω–∏–µ\n` +
          `‚Ä¢ –°–Ω–æ—Ä–∫–ª–∏–Ω–≥ –≤–µ–∑–¥–µ\n` +
          `‚Ä¢ –í—Å–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—ã\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 8000‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 6500‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/five-pearls-2days' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 2Ô∏è‚É£0Ô∏è‚É£ –ü–•–ê–ù–ì –ù–ì–ê + –°–ê–ú–ï–¢
  if (startParam === 'phangngasamet') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/phangnga-samet.jpg',
      {
        caption: 
          `üèùÔ∏è –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –ü—Ö–∞–Ω–≥ –ù–≥–∞ + –°–∞–º–µ—Ç\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –ü—Ö–∞–Ω–≥ –ù–≥–∞ –∑–∞–ª–∏–≤\n` +
          `‚Ä¢ –û—Å—Ç—Ä–æ–≤ –°–∞–º–µ—Ç\n` +
          `‚Ä¢ –ö–∞–Ω–æ—ç\n` +
          `‚Ä¢ –û–±–µ–¥ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 2200‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 1600‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/phang-nga-samet' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // 2Ô∏è‚É£1Ô∏è‚É£ –°–ï–ö–†–ï–¢–´ –ö–†–ê–ë–ò
  if (startParam === 'krabi') {
    await ctx.replyWithPhoto(
      'https://phukeo.com/assets/krabi-main.jpg',
      {
        caption: 
          `üóª –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
          `‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏: –°–µ–∫—Ä–µ—Ç—ã –ö—Ä–∞–±–∏\n\n` +
          `üìã –ß–¢–û –í–•–û–î–ò–¢:\n` +
          `‚Ä¢ –°–∫—Ä—ã—Ç—ã–µ –ø–ª—è–∂–∏ –ö—Ä–∞–±–∏\n` +
          `‚Ä¢ –ò–∑—É–º—Ä—É–¥–Ω—ã–π –±–∞—Å—Å–µ–π–Ω\n` +
          `‚Ä¢ –ì–æ—Ä—è—á–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏\n` +
          `‚Ä¢ –•—Ä–∞–º —Ç–∏–≥—Ä–∞\n` +
          `‚Ä¢ –û–±–µ–¥ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n\n` +
          `üí∞ –¶–ï–ù–ê:\n` +
          `‚Ä¢ –í–∑—Ä–æ—Å–ª—ã–π: 2400‡∏ø\n` +
          `‚Ä¢ –†–µ–±—ë–Ω–æ–∫ (4-11 –ª–µ—Ç): 1800‡∏ø\n\n` +
          `üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É! ‚¨áÔ∏è`,
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üì± –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', web_app: { url: 'https://phukeo.com/#/tours/krabi-secrets' } }],
            [{ text: 'üó∫Ô∏è –í—Å–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    return;
  }
  
  // –û–±—ã—á–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ (–µ—Å–ª–∏ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞) - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
  await ctx.reply(
    `üëã –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
    `–Ø –ø–æ–º–æ–≥—É –≤—ã–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π —Ç—É—Ä –Ω–∞ –ü—Ö—É–∫–µ—Ç–µ! üèùÔ∏è\n\n` +
    `–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:`,
    Markup.inlineKeyboard([
      [Markup.button.callback('üó∫Ô∏è –°–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ä—ã', 'show_catalog')],
      [Markup.button.callback('ÔøΩ –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å', 'ask_question')],
      [Markup.button.url('‚òéÔ∏è –°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º', 'https://t.me/Phuketga')]
    ])
  );
});

// üìö –ö–û–ú–ê–ù–î–ê /help
bot.command('help', (ctx) => {
  ctx.replyWithMarkdown(`üìö **–°–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É**

üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/tours - –°–ø–∏—Å–æ–∫ —Ç—É—Ä–æ–≤
/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
/contacts - –ù–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã

üì± **–ö–∞–∫ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å:**
1Ô∏è‚É£ –û—Ç–∫—Ä–æ–π –∫–∞—Ç–∞–ª–æ–≥ —Ç—É—Ä–æ–≤
2Ô∏è‚É£ –í—ã–±–µ—Ä–∏ —Ç—É—Ä
3Ô∏è‚É£ –ù–∞–∂–º–∏ "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å"
4Ô∏è‚É£ –ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É

üí¨ **–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?** –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å!`);
});

// üó∫Ô∏è –ö–û–ú–ê–ù–î–ê /tours
bot.command('tours', (ctx) => {
  ctx.replyWithMarkdown(`üèùÔ∏è **–ù–∞—à–∏ —Ç—É—Ä—ã:**

1Ô∏è‚É£ Maya Bay Sunrise üåÖ
2Ô∏è‚É£ Phi Phi Islands Premium üèùÔ∏è
3Ô∏è‚É£ James Bond Island üé¨
4Ô∏è‚É£ Similan Islands üê†
5Ô∏è‚É£ 4 Islands by Speedboat ‚ö°
6Ô∏è‚É£ Coral Island Paradise ü™∏
7Ô∏è‚É£ Banana Beach Escape üçå
8Ô∏è‚É£ Racha Island Diving ü§ø
9Ô∏è‚É£ Khai Islands Snorkeling üèñÔ∏è
üîü Promthep Sunset üåÖ
1Ô∏è‚É£1Ô∏è‚É£ Cheow Lan Lake üèûÔ∏è

üì± [–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥](https://t.me/phuketgos_bot/app)`);
});

// ‚òéÔ∏è –ö–û–ú–ê–ù–î–ê /contacts
bot.command('contacts', (ctx) => {
  ctx.replyWithMarkdown(`‚òéÔ∏è **–°–≤—è–∂–∏—Å—å —Å –Ω–∞–º–∏:**

üì± Telegram: @phuketgos_bot
üåê –°–∞–π—Ç: https://phukeo.com
üìß Email: info@phukeo.com

‚è∞ **–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:**
–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: 8:00 - 22:00 (Bangkok Time)

üí¨ –û—Ç–≤–µ—á–∞–µ–º –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç!`);
});

// üîç –ö–û–ú–ê–ù–î–ê /getid - –ü–æ–ª—É—á–∏—Ç—å ID –≥—Ä—É–ø–ø—ã/—á–∞—Ç–∞
bot.command('getid', (ctx) => {
  const chatId = ctx.chat.id;
  const chatType = ctx.chat.type;
  const chatTitle = ctx.chat.title || '–õ–∏—á–Ω—ã–π —á–∞—Ç';
  
  ctx.reply(`üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ:

üÜî ID: \`${chatId}\`
üìù –¢–∏–ø: ${chatType}
üè∑Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ: ${chatTitle}

${chatType === 'private' ? 'üí° –î–æ–±–∞–≤—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É –∏ –∏—Å–ø–æ–ª—å–∑—É–π —ç—Ç—É –∫–æ–º–∞–Ω–¥—É —Ç–∞–º, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å ID –≥—Ä—É–ø–ø—ã' : '‚úÖ –°–æ—Ö—Ä–∞–Ω–∏ —ç—Ç–æ—Ç ID –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞'}`, 
    { parse_mode: 'Markdown' }
  );
});

// üìä –ö–û–ú–ê–ù–î–ê /stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–ø—ã
bot.command('stats', async (ctx) => {
  const chatType = ctx.chat.type;
  
  if (chatType === 'private') {
    return ctx.reply('‚ùå –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–∞—Ö');
  }
  
  const topTours = Object.entries(groupStats.tourMentions)
    .sort((a, b) => b[1] - a[1])
    .filter(([_, count]) => count > 0)
    .slice(0, 5)
    .map(([tour, count]) => `${tour}: ${count} —É–ø–æ–º–∏–Ω–∞–Ω–∏–π`)
    .join('\n') || '–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
  
  const report = `üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–ø—ã**

üí¨ –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π: ${groupStats.messages}
üë• –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${groupStats.users.size}
‚ùì –í–æ–ø—Ä–æ—Å–æ–≤: ${groupStats.questions}

üèÜ **–¢–æ–ø —Ç—É—Ä–æ–≤:**
${topTours}

üìÖ –ü–µ—Ä–∏–æ–¥: —Å ${groupStats.lastReset.toLocaleDateString('ru-RU')}`;

  ctx.replyWithMarkdown(report);
});

// üîÑ –ö–û–ú–ê–ù–î–ê /resetstats
bot.command('resetstats', (ctx) => {
  groupStats.messages = 0;
  Object.keys(groupStats.tourMentions).forEach(key => groupStats.tourMentions[key] = 0);
  groupStats.users.clear();
  groupStats.questions = 0;
  groupStats.lastReset = new Date();
  
  ctx.reply('‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞!');
});

// üîî CALLBACK –ö–ù–û–ü–ö–ò –î–õ–Ø –ì–õ–ê–í–ù–û–ì–û –ú–ï–ù–Æ

// üó∫Ô∏è –ö–ù–û–ü–ö–ê "–°–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ä—ã" - –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
bot.action('show_catalog', async (ctx) => {
  await ctx.answerCbQuery();
  await ctx.reply(
    `üó∫Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç—É—Ä–æ–≤:\n\n` +
    `üèùÔ∏è –û—Å—Ç—Ä–æ–≤–∞ - —Å–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—É—Ä—ã –Ω–∞ –æ—Å—Ç—Ä–æ–≤–∞\n` +
    `üèîÔ∏è –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è - –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö –∏ —ç–∫—Å—Ç—Ä–∏–º\n` +
    `üõï –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ - —Ö—Ä–∞–º—ã, –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n` +
    `ü§ø –î–∞–π–≤–∏–Ω–≥ - –ø–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä –∏ —Å–Ω–æ—Ä–∫–ª–∏–Ω–≥\n` +
    `üé£ –†—ã–±–∞–ª–∫–∞ - –º–æ—Ä—Å–∫–∞—è —Ä—ã–±–∞–ª–∫–∞ –Ω–∞ —Ä–∞—Å—Å–≤–µ—Ç–µ`,
    Markup.inlineKeyboard([
      [Markup.button.callback(`üèùÔ∏è –û—Å—Ç—Ä–æ–≤–∞ (${categories.islands.tours.length})`, 'cat_islands')],
      [Markup.button.callback(`üèîÔ∏è –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è (${categories.adventure.tours.length})`, 'cat_adventure')],
      [Markup.button.callback(`üõï –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ (${categories.cultural.tours.length})`, 'cat_cultural')],
      [Markup.button.callback(`ü§ø –î–∞–π–≤–∏–Ω–≥ (${categories.diving.tours.length})`, 'cat_diving')],
      [Markup.button.callback(`üé£ –†—ã–±–∞–ª–∫–∞ (${categories.fishing.tours.length})`, 'cat_fishing')],
      [Markup.button.callback('¬´ –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é', 'back_to_menu')]
    ])
  );
});

// üí¨ –ö–ù–û–ü–ö–ê "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å" (placeholder –¥–ª—è –±—É–¥—É—â–µ–≥–æ ChatGPT)
bot.action('ask_question', async (ctx) => {
  await ctx.answerCbQuery();
  await ctx.reply(
    `üí¨ –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞—Ç—å –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –æ —Ç—É—Ä–∞—Ö!\n\n` +
    `–ù–∞–ø—Ä–∏–º–µ—Ä:\n` +
    `‚Ä¢ "–ö–∞–∫–æ–π —Ç—É—Ä –ª—É—á—à–µ –¥–ª—è –¥–µ—Ç–µ–π?"\n` +
    `‚Ä¢ "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –ø–æ–µ–∑–¥–∫–∞ –Ω–∞ –ü—Ö–∏-–ü—Ö–∏?"\n` +
    `‚Ä¢ "–ß—Ç–æ –≤–∑—è—Ç—å —Å —Å–æ–±–æ–π –Ω–∞ —ç–∫—Å–∫—É—Ä—Å–∏—é?"\n\n` +
    `ü§ñ –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è AI-–ø–æ–º–æ—â–Ω–∏–∫!\n` +
    `–ê –ø–æ–∫–∞ –≤—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º:`,
    Markup.inlineKeyboard([
      [Markup.button.url('‚òéÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É', 'https://t.me/Phuketga')],
      [Markup.button.callback('¬´ –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é', 'back_to_menu')]
    ])
  );
});

// ‚Ü©Ô∏è –ö–ù–û–ü–ö–ê "–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"
bot.action('back_to_menu', async (ctx) => {
  await ctx.answerCbQuery();
  const firstName = ctx.from.first_name || '–¥—Ä—É–≥';
  await ctx.reply(
    `üëã –ü—Ä–∏–≤–µ—Ç, ${firstName}!\n\n` +
    `–Ø –ø–æ–º–æ–≥—É –≤—ã–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π —Ç—É—Ä –Ω–∞ –ü—Ö—É–∫–µ—Ç–µ! üèùÔ∏è\n\n` +
    `–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:`,
    Markup.inlineKeyboard([
      [Markup.button.callback('üó∫Ô∏è –°–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ä—ã', 'show_catalog')],
      [Markup.button.callback('üí¨ –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å', 'ask_question')],
      [Markup.button.url('‚òéÔ∏è –°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º', 'https://t.me/Phuketga')]
    ])
  );
});

// ÔøΩ –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–ê–¢–ï–ì–û–†–ò–ô

// üèùÔ∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–û—Å—Ç—Ä–æ–≤–∞"
bot.action('cat_islands', async (ctx) => {
  await ctx.answerCbQuery();
  const categoryData = categories.islands;
  const buttons = categoryData.tours.map(tourId => {
    const tour = tours[tourId];
    return [Markup.button.callback(
      `${tour.name} - –æ—Ç ${tour.priceAdult}‡∏ø`,
      `tour_${tourId}`
    )];
  });
  buttons.push([Markup.button.callback('¬´ –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º', 'show_catalog')]);
  
  await ctx.reply(
    `${categoryData.emoji} ${categoryData.name}\n\n` +
    `–í—ã–±–µ—Ä–∏—Ç–µ —Ç—É—Ä –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π:`,
    Markup.inlineKeyboard(buttons)
  );
});

// üèîÔ∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è"
bot.action('cat_adventure', async (ctx) => {
  await ctx.answerCbQuery();
  const categoryData = categories.adventure;
  const buttons = categoryData.tours.map(tourId => {
    const tour = tours[tourId];
    return [Markup.button.callback(
      `${tour.name} - –æ—Ç ${tour.priceAdult}‡∏ø`,
      `tour_${tourId}`
    )];
  });
  buttons.push([Markup.button.callback('¬´ –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º', 'show_catalog')]);
  
  await ctx.reply(
    `${categoryData.emoji} ${categoryData.name}\n\n` +
    `–í—ã–±–µ—Ä–∏—Ç–µ —Ç—É—Ä –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π:`,
    Markup.inlineKeyboard(buttons)
  );
});

// üõï –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–ö—É–ª—å—Ç—É—Ä–Ω—ã–µ"
bot.action('cat_cultural', async (ctx) => {
  await ctx.answerCbQuery();
  const categoryData = categories.cultural;
  const buttons = categoryData.tours.map(tourId => {
    const tour = tours[tourId];
    return [Markup.button.callback(
      `${tour.name} - –æ—Ç ${tour.priceAdult}‡∏ø`,
      `tour_${tourId}`
    )];
  });
  buttons.push([Markup.button.callback('¬´ –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º', 'show_catalog')]);
  
  await ctx.reply(
    `${categoryData.emoji} ${categoryData.name}\n\n` +
    `–í—ã–±–µ—Ä–∏—Ç–µ —Ç—É—Ä –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π:`,
    Markup.inlineKeyboard(buttons)
  );
});

// ü§ø –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–î–∞–π–≤–∏–Ω–≥"
bot.action('cat_diving', async (ctx) => {
  await ctx.answerCbQuery();
  const categoryData = categories.diving;
  const buttons = categoryData.tours.map(tourId => {
    const tour = tours[tourId];
    return [Markup.button.callback(
      `${tour.name} - –æ—Ç ${tour.priceAdult}‡∏ø`,
      `tour_${tourId}`
    )];
  });
  buttons.push([Markup.button.callback('¬´ –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º', 'show_catalog')]);
  
  await ctx.reply(
    `${categoryData.emoji} ${categoryData.name}\n\n` +
    `–í—ã–±–µ—Ä–∏—Ç–µ —Ç—É—Ä –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π:`,
    Markup.inlineKeyboard(buttons)
  );
});

// üé£ –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–†—ã–±–∞–ª–∫–∞"
bot.action('cat_fishing', async (ctx) => {
  await ctx.answerCbQuery();
  const categoryData = categories.fishing;
  const buttons = categoryData.tours.map(tourId => {
    const tour = tours[tourId];
    return [Markup.button.callback(
      `${tour.name} - –æ—Ç ${tour.priceAdult}‡∏ø`,
      `tour_${tourId}`
    )];
  });
  buttons.push([Markup.button.callback('¬´ –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º', 'show_catalog')]);
  
  await ctx.reply(
    `${categoryData.emoji} ${categoryData.name}\n\n` +
    `–í—ã–±–µ—Ä–∏—Ç–µ —Ç—É—Ä –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π:`,
    Markup.inlineKeyboard(buttons)
  );
});

// ÔøΩüîî CALLBACK –ö–ù–û–ü–ö–ò (—Å—Ç–∞—Ä—ã–µ)
bot.action('about', (ctx) => {
  ctx.answerCbQuery();
  ctx.replyWithMarkdown(`üå¥ **–û –∫–æ–º–ø–∞–Ω–∏–∏ –ü—Ö—É–∫–µ—Ç Go**

–ú—ã ‚Äî –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤ —Å 10+ –ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã –Ω–∞ –ü—Ö—É–∫–µ—Ç–µ.

‚ú® **–ü–æ—á–µ–º—É –º—ã:**
‚Ä¢ üèÜ –õ—É—á—à–∏–µ —Ü–µ–Ω—ã –±–µ–∑ –Ω–∞—Ü–µ–Ω–æ–∫
‚Ä¢ ‚≠ê –†–µ–π—Ç–∏–Ω–≥ 4.9/5.0 (2000+ –æ—Ç–∑—ã–≤–æ–≤)
‚Ä¢ üöó –¢—Ä–∞–Ω—Å—Ñ–µ—Ä –≤–∫–ª—é—á—ë–Ω
‚Ä¢ üéØ –†—É—Å—Å–∫–æ–≥–æ–≤–æ—Ä—è—â–∏–µ –≥–∏–¥—ã
‚Ä¢ üíØ –ì–∞—Ä–∞–Ω—Ç–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–µ–Ω–µ–≥`);
});

bot.action('contacts', (ctx) => {
  ctx.answerCbQuery();
  ctx.replyWithMarkdown(`‚òéÔ∏è **–ö–æ–Ω—Ç–∞–∫—Ç—ã:**

üì± Telegram: @phuketgos_bot
üåê –°–∞–π—Ç: https://phukeo.com
üìß Email: info@phukeo.com

‚è∞ –†–∞–±–æ—Ç–∞–µ–º: 8:00 - 22:00 (Bangkok Time)
üí¨ –û—Ç–≤–µ—Ç–∏–º –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç!`);
});

// üéØ –°–ò–°–¢–ï–ú–ê –ë–†–û–ù–ò–†–û–í–ê–ù–ò–ô
// –•—Ä–∞–Ω–∏–ª–∏—â–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (–≤ –ø–∞–º—è—Ç–∏)
const bookingSessions = new Map();

// –î–∞–Ω–Ω—ã–µ —Ç—É—Ä–æ–≤ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
const toursData = {
  'rafting': { name: '–†–∞—Ñ—Ç–∏–Ω–≥ + –°–ü–ê + ATV', priceAdult: 2500, priceChild: 1800 },
  'phiphi2days': { name: '–ü—Ö–∏-–ü—Ö–∏ 2 –¥–Ω—è/1 –Ω–æ—á—å', priceAdult: 6500, priceChild: 5500 },
  'pearls': { name: '4 –ñ–µ–º—á—É–∂–∏–Ω—ã –ê–Ω–¥–∞–º–∞–Ω—Å–∫–æ–≥–æ –º–æ—Ä—è', priceAdult: 8500, priceChild: 7000 },
  'sightseeing': { name: '–î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ü—Ö—É–∫–µ—Ç–∞', priceAdult: 1800, priceChild: 1200 },
  'raftingspa': { name: '–†–∞—Ñ—Ç–∏–Ω–≥ + –°–ü–ê', priceAdult: 2200, priceChild: 1600 },
  'kaolak': { name: '–ö–∞–æ –õ–∞–∫ –°–∞—Ñ–∞—Ä–∏', priceAdult: 2600, priceChild: 2000 },
  '11islands': { name: '11 –æ—Å—Ç—Ä–æ–≤–æ–≤ –ú–ï–ì–ê-–¢–£–†', priceAdult: 4500, priceChild: 3500 },
  'jamesbond': { name: '–û—Å—Ç—Ä–æ–≤ –î–∂–µ–π–º—Å–∞ –ë–æ–Ω–¥–∞', priceAdult: 2400, priceChild: 1800 },
  'avatarplus': { name: '–ê–≤–∞—Ç–∞—Ä –ü–ª—é—Å + –•–∞–Ω–≥–¥–æ–Ω–≥', priceAdult: 2800, priceChild: 2200 },
  'racha': { name: '–†–∞—á–∞ + –ö–æ—Ä–∞–ª', priceAdult: 2200, priceChild: 1600 },
  'skywalk': { name: '–ü—Ö–∞–Ω–≥ –ù–≥–∞ + –°—Ç–µ–∫–ª—è–Ω–Ω—ã–π –º–æ—Å—Ç', priceAdult: 2600, priceChild: 2000 },
  'cheolan': { name: '–ß–µ–æ –õ–∞–Ω + –°–∞–º–µ—Ç', priceAdult: 2800, priceChild: 2200 },
  'similan': { name: '–°–∏–º–∏–ª–∞–Ω—ã Standard', priceAdult: 3500, priceChild: 2800 },
  'similanearly': { name: '–°–∏–º–∏–ª–∞–Ω—ã Early Bird', priceAdult: 4000, priceChild: 3200 },
  'similanspeed': { name: '–°–∏–º–∏–ª–∞–Ω—ã Speedboat', priceAdult: 4500, priceChild: 3500 },
  'fishing': { name: '–†—ã–±–∞–ª–∫–∞ –Ω–∞ —Ä–∞—Å—Å–≤–µ—Ç–µ', priceAdult: 3000, priceChild: 2400 },
  'rachasunrise': { name: '–†–∞—á–∞ + –ö–æ—Ä–∞–ª —Ä–∞—Å—Å–≤–µ—Ç', priceAdult: 2600, priceChild: 2000 },
  'racharawai': { name: '–†–∞—á–∞ + –ö–æ—Ä–∞–ª Rawai', priceAdult: 2200, priceChild: 1600 },
  'phiphisunrise': { name: '–ü—Ö–∏-–ü—Ö–∏ —Ä–∞—Å—Å–≤–µ—Ç', priceAdult: 3200, priceChild: 2600 },
  '5pearls': { name: '5 –ñ–µ–º—á—É–∂–∏–Ω 2 –¥–Ω—è', priceAdult: 9500, priceChild: 8000 },
  'phangngasamet': { name: '–ü—Ö–∞–Ω–≥ –ù–≥–∞ + –°–∞–º–µ—Ç', priceAdult: 2200, priceChild: 1600 },
  'krabi': { name: '–°–µ–∫—Ä–µ—Ç—ã –ö—Ä–∞–±–∏', priceAdult: 2400, priceChild: 1800 }
};

// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Ç—É—Ä–æ–≤
Object.keys(toursData).forEach(tourId => {
  bot.action(`book_${tourId}`, async (ctx) => {
    await ctx.answerCbQuery();
    
    const userId = ctx.from.id;
    const tour = toursData[tourId];
    
    // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    bookingSessions.set(userId, {
      tourId: tourId,
      tourName: tour.name,
      priceAdult: tour.priceAdult,
      priceChild: tour.priceChild,
      step: 'name' // name ‚Üí date ‚Üí adults ‚Üí children ‚Üí contact ‚Üí confirm
    });
    
    await ctx.reply(
      `‚úÖ –û—Ç–ª–∏—á–Ω–æ! –ë—Ä–æ–Ω–∏—Ä—É–µ–º —Ç—É—Ä:\nüèùÔ∏è **${tour.name}**\n\n` +
      `üí∞ –¶–µ–Ω–∞: ${tour.priceAdult}‡∏ø –≤–∑—Ä–æ—Å–ª—ã–π, ${tour.priceChild}‡∏ø —Ä–µ–±—ë–Ω–æ–∫\n\n` +
      `üìù **–®–∞–≥ 1 –∏–∑ 5: –í–∞—à–µ –∏–º—è**\n\n` +
      `–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é:`,
      {
        reply_markup: {
          inline_keyboard: [
            [{ text: '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', callback_data: 'cancel_booking' }]
          ]
        }
      }
    );
  });
});

// –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
bot.action('cancel_booking', async (ctx) => {
  await ctx.answerCbQuery();
  const userId = ctx.from.id;
  bookingSessions.delete(userId);
  
  await ctx.reply('‚ùå –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.\n\nüí¨ –ß–µ–º –µ—â—ë –º–æ–≥—É –ø–æ–º–æ—á—å?');
});

// –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≤–∑—Ä–æ—Å–ª—ã—Ö
for (let i = 1; i <= 10; i++) {
  bot.action(`adults_${i}`, async (ctx) => {
    await ctx.answerCbQuery();
    const userId = ctx.from.id;
    const session = bookingSessions.get(userId);
    
    if (!session || session.step !== 'adults') return;
    
    session.adults = i;
    session.step = 'children';
    
    await ctx.reply(
      `‚úÖ –í–∑—Ä–æ—Å–ª—ã—Ö: ${i}\n\n` +
      `üìù **–®–∞–≥ 4 –∏–∑ 5: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç–µ–π**\n\n` +
      `–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç–µ–π (4-11 –ª–µ—Ç).\n` +
      `–ï—Å–ª–∏ –¥–µ—Ç–µ–π –Ω–µ—Ç, –Ω–∞–ø–∏—à–∏—Ç–µ 0:`,
      {
        reply_markup: {
          inline_keyboard: [
            [{ text: '0', callback_data: 'children_0' }, { text: '1', callback_data: 'children_1' }, { text: '2', callback_data: 'children_2' }],
            [{ text: '3', callback_data: 'children_3' }, { text: '4', callback_data: 'children_4' }, { text: '5', callback_data: 'children_5' }],
            [{ text: '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å', callback_data: 'cancel_booking' }]
          ]
        }
      }
    );
  });
}

// –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ –¥–µ—Ç–µ–π
for (let i = 0; i <= 10; i++) {
  bot.action(`children_${i}`, async (ctx) => {
    await ctx.answerCbQuery();
    const userId = ctx.from.id;
    const session = bookingSessions.get(userId);
    
    if (!session || session.step !== 'children') return;
    
    session.children = i;
    session.step = 'contact';
    
    await ctx.reply(
      `‚úÖ –î–µ—Ç–µ–π: ${i}\n\n` +
      `üìù **–®–∞–≥ 5 –∏–∑ 5: –ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏**\n\n` +
      `–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–ª–∏ Telegram:\n` +
      `–ù–∞–ø—Ä–∏–º–µ—Ä: +66 12 345 6789 –∏–ª–∏ @username`,
      {
        reply_markup: {
          inline_keyboard: [
            [{ text: '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å', callback_data: 'cancel_booking' }]
          ]
        }
      }
    );
  });
}

// –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
bot.action('confirm_booking', async (ctx) => {
  await ctx.answerCbQuery();
  const userId = ctx.from.id;
  const session = bookingSessions.get(userId);
  
  if (!session) {
    await ctx.reply('‚ùå –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ù–∞—á–Ω–∏—Ç–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–Ω–æ–≤–æ.');
    return;
  }
  
  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
  const totalAdults = session.adults * session.priceAdult;
  const totalChildren = session.children * session.priceChild;
  const totalPrice = totalAdults + totalChildren;
  
  // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∞
  const adminMessage = 
    `üîî **–ù–û–í–ê–Ø –ë–†–û–ù–¨!**\n\n` +
    `üèùÔ∏è **–¢—É—Ä:** ${session.tourName}\n` +
    `üë§ **–ò–º—è:** ${session.name}\n` +
    `üìÖ **–î–∞—Ç–∞:** ${session.date}\n` +
    `üë• **–í–∑—Ä–æ—Å–ª—ã—Ö:** ${session.adults} —á–µ–ª.\n` +
    `üë∂ **–î–µ—Ç–µ–π:** ${session.children} —á–µ–ª.\n` +
    `üì± **–ö–æ–Ω—Ç–∞–∫—Ç:** ${session.contact}\n\n` +
    `üí∞ **–°—É–º–º–∞:** ${totalPrice}‡∏ø\n\n` +
    `üÜî User ID: ${userId}\n` +
    `üë§ Username: @${ctx.from.username || '–Ω–µ—Ç'}\n` +
    `üìù –ò–º—è –≤ Telegram: ${ctx.from.first_name} ${ctx.from.last_name || ''}`;
  
  try {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∞–¥–º–∏–Ω—É
    const ADMIN_CHAT_ID = process.env.ADMIN_CHAT_ID || '1217592929';
    await bot.telegram.sendMessage(ADMIN_CHAT_ID, adminMessage, { parse_mode: 'Markdown' });
    
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É
    await ctx.reply(
      `‚úÖ **–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!**\n\n` +
      `–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞ –∏ –ø–µ—Ä–µ–¥–∞–Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä—É.\n\n` +
      `üì± –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.\n\n` +
      `–ù–æ–º–µ—Ä –±—Ä–æ–Ω–∏: #${userId}${Date.now().toString().slice(-4)}\n\n` +
      `üí¨ –ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –ø–∏—à–∏—Ç–µ @Phuketga`,
      {
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üó∫Ô∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ —Ç—É—Ä—ã', web_app: { url: 'https://phukeo.com' } }],
            [{ text: '‚òéÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É', url: 'https://t.me/Phuketga' }]
          ]
        }
      }
    );
    
    // –£–¥–∞–ª—è–µ–º —Å–µ—Å—Å–∏—é
    bookingSessions.delete(userId);
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –±—Ä–æ–Ω–∏ –∞–¥–º–∏–Ω—É:', error);
    await ctx.reply(
      `‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ.\n\n` +
      `–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –Ω–∞–ø—Ä—è–º—É—é:\n` +
      `üì± @Phuketga\n\n` +
      `–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ:\n` +
      `üèùÔ∏è ${session.tourName}\n` +
      `üìÖ ${session.date}\n` +
      `üë• ${session.adults} –≤–∑—Ä–æ—Å–ª—ã—Ö, ${session.children} –¥–µ—Ç–µ–π`
    );
  }
});


// üí¨ –û–ë–†–ê–ë–û–¢–ö–ê –¢–ï–ö–°–¢–û–í–´–• –°–û–û–ë–©–ï–ù–ò–ô
bot.on('message', async (ctx) => {
  if (!ctx.message.text) return;
  
  const chatType = ctx.chat.type;
  const text = ctx.message.text;
  const userId = ctx.from.id;
  
  // üéØ –û–ë–†–ê–ë–û–¢–ö–ê –ê–ö–¢–ò–í–ù–û–ô –°–ï–°–°–ò–ò –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø
  if (chatType === 'private' && bookingSessions.has(userId)) {
    const session = bookingSessions.get(userId);
    
    // –®–ê–ì 1: –ò–º—è
    if (session.step === 'name') {
      session.name = text;
      session.step = 'date';
      
      await ctx.reply(
        `‚úÖ –û—Ç–ª–∏—á–Ω–æ, ${text}!\n\n` +
        `üìù **–®–∞–≥ 2 –∏–∑ 5: –î–∞—Ç–∞ —Ç—É—Ä–∞**\n\n` +
        `–í–≤–µ–¥–∏—Ç–µ –∂–µ–ª–∞–µ–º—É—é –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì\n` +
        `–ù–∞–ø—Ä–∏–º–µ—Ä: 15.11.2025`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å', callback_data: 'cancel_booking' }]
            ]
          }
        }
      );
      return;
    }
    
    // –®–ê–ì 2: –î–∞—Ç–∞
    if (session.step === 'date') {
      session.date = text;
      session.step = 'adults';
      
      await ctx.reply(
        `‚úÖ –î–∞—Ç–∞: ${text}\n\n` +
        `üìù **–®–∞–≥ 3 –∏–∑ 5: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∑—Ä–æ—Å–ª—ã—Ö**\n\n` +
        `–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∑—Ä–æ—Å–ª—ã—Ö (–æ—Ç 1 –¥–æ 10):`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: '1', callback_data: 'adults_1' }, { text: '2', callback_data: 'adults_2' }, { text: '3', callback_data: 'adults_3' }],
              [{ text: '4', callback_data: 'adults_4' }, { text: '5', callback_data: 'adults_5' }, { text: '6', callback_data: 'adults_6' }],
              [{ text: '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å', callback_data: 'cancel_booking' }]
            ]
          }
        }
      );
      return;
    }
    
    // –®–ê–ì 3: –í–∑—Ä–æ—Å–ª—ã–µ (–µ—Å–ª–∏ –≤–≤–µ–ª–∏ —Ç–µ–∫—Å—Ç–æ–º)
    if (session.step === 'adults') {
      const adults = parseInt(text);
      if (isNaN(adults) || adults < 1 || adults > 10) {
        await ctx.reply('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10');
        return;
      }
      
      session.adults = adults;
      session.step = 'children';
      
      await ctx.reply(
        `‚úÖ –í–∑—Ä–æ—Å–ª—ã—Ö: ${adults}\n\n` +
        `üìù **–®–∞–≥ 4 –∏–∑ 5: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç–µ–π**\n\n` +
        `–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç–µ–π (4-11 –ª–µ—Ç).\n` +
        `–ï—Å–ª–∏ –¥–µ—Ç–µ–π –Ω–µ—Ç, –Ω–∞–ø–∏—à–∏—Ç–µ 0:`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: '0', callback_data: 'children_0' }, { text: '1', callback_data: 'children_1' }, { text: '2', callback_data: 'children_2' }],
              [{ text: '3', callback_data: 'children_3' }, { text: '4', callback_data: 'children_4' }, { text: '5', callback_data: 'children_5' }],
              [{ text: '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å', callback_data: 'cancel_booking' }]
            ]
          }
        }
      );
      return;
    }
    
    // –®–ê–ì 4: –î–µ—Ç–∏ (–µ—Å–ª–∏ –≤–≤–µ–ª–∏ —Ç–µ–∫—Å—Ç–æ–º)
    if (session.step === 'children') {
      const children = parseInt(text);
      if (isNaN(children) || children < 0 || children > 10) {
        await ctx.reply('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10');
        return;
      }
      
      session.children = children;
      session.step = 'contact';
      
      await ctx.reply(
        `‚úÖ –î–µ—Ç–µ–π: ${children}\n\n` +
        `üìù **–®–∞–≥ 5 –∏–∑ 5: –ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏**\n\n` +
        `–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–ª–∏ Telegram:\n` +
        `–ù–∞–ø—Ä–∏–º–µ—Ä: +66 12 345 6789 –∏–ª–∏ @username`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: 'üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º', request_contact: true }],
              [{ text: '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å', callback_data: 'cancel_booking' }]
            ]
          }
        }
      );
      return;
    }
    
    // –®–ê–ì 5: –ö–æ–Ω—Ç–∞–∫—Ç
    if (session.step === 'contact') {
      session.contact = text;
      session.step = 'confirm';
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
      const totalAdults = session.adults * session.priceAdult;
      const totalChildren = session.children * session.priceChild;
      const totalPrice = totalAdults + totalChildren;
      
      await ctx.reply(
        `üìã **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**\n\n` +
        `üèùÔ∏è –¢—É—Ä: **${session.tourName}**\n` +
        `üë§ –ò–º—è: ${session.name}\n` +
        `üìÖ –î–∞—Ç–∞: ${session.date}\n` +
        `üë• –í–∑—Ä–æ—Å–ª—ã—Ö: ${session.adults} x ${session.priceAdult}‡∏ø = ${totalAdults}‡∏ø\n` +
        `üë∂ –î–µ—Ç–µ–π: ${session.children} x ${session.priceChild}‡∏ø = ${totalChildren}‡∏ø\n` +
        `üì± –ö–æ–Ω—Ç–∞–∫—Ç: ${session.contact}\n\n` +
        `üí∞ **–ò—Ç–æ–≥–æ: ${totalPrice}‡∏ø**\n\n` +
        `‚úÖ –í—Å—ë –≤–µ—Ä–Ω–æ? –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:`,
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å', callback_data: 'confirm_booking' }],
              [{ text: '‚úèÔ∏è –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ', callback_data: 'cancel_booking' }],
              [{ text: '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å', callback_data: 'cancel_booking' }]
            ]
          }
        }
      );
      return;
    }
  }
  
  // –î–ª—è –≥—Ä—É–ø–ø –∏ –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π - –ø—Ä–µ–∂–Ω—è—è –ª–æ–≥–∏–∫–∞
  const textLower = text.toLowerCase();
  
  // –í –≥—Ä—É–ø–ø–∞—Ö —Ç–æ–ª—å–∫–æ —Å–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–Ω–µ –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
  if (chatType === 'group' || chatType === 'supergroup') {
    const userId = ctx.from.id;
    
    // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    groupStats.messages++;
    groupStats.users.add(userId);
    
    // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ç—É—Ä–æ–≤
    Object.entries(keywords.tours).forEach(([tourName, tourKeywords]) => {
      if (tourKeywords.some(keyword => text.includes(keyword.toLowerCase()))) {
        groupStats.tourMentions[tourName]++;
      }
    });
    
    // –°—á–∏—Ç–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã
    if (keywords.questions.some(keyword => text.includes(keyword))) {
      groupStats.questions++;
    }
    
    // –õ–æ–≥–∏—Ä—É–µ–º
    console.log(`üìä [${ctx.chat.title}] ${ctx.from.first_name}: "${text.substring(0, 50)}..."`);
    
    return; // –ù–µ –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ
  }
  
  // –í –ª–∏—á–∫–µ - –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
  if (text.includes('—Ü–µ–Ω–∞') || text.includes('—Å—Ç–æ–∏–º–æ—Å—Ç—å') || text.includes('—Å–∫–æ–ª—å–∫–æ')) {
    ctx.reply('üí∞ –¶–µ–Ω—ã –Ω–∞ —Ç—É—Ä—ã —Å–º–æ—Ç—Ä–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ: https://t.me/phuketgos_bot/app\n\n–í—ã–±–µ—Ä–∏ —Ç—É—Ä –∏ —É–≤–∏–¥–∏—à—å —Ç–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å!');
  } else if (text.includes('–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å') || text.includes('–∑–∞–∫–∞–∑–∞—Ç—å')) {
    ctx.reply('‚úÖ –û—Ç–ª–∏—á–Ω–æ! –û—Ç–∫—Ä–æ–π –∫–∞—Ç–∞–ª–æ–≥ –∏ –≤—ã–±–µ—Ä–∏ —Ç—É—Ä:\nhttps://t.me/phuketgos_bot/app\n\n–ó–∞—Ç–µ–º –Ω–∞–∂–º–∏ "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å" –∏ –∑–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É.');
  } else if (text.includes('–∫–æ–Ω—Ç–∞–∫—Ç') || text.includes('—Å–≤—è–∑—å')) {
    ctx.reply('üìû –ü–∏—à–∏ –ø—Ä—è–º–æ —Å—é–¥–∞! –ú—ã –æ—Ç–≤–µ—á–∞–µ–º –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç.\n\n–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É /contacts');
  } else {
    ctx.reply(`üëã –ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –ü—Ö—É–∫–µ—Ç Go.\n\nüó∫Ô∏è –•–æ—á–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ä—ã? –ù–∞–∂–º–∏ /start\nüìö –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –ù–∞–∂–º–∏ /help`);
  }
});

// üöÄ –ó–ê–ü–£–°–ö –ë–û–¢–ê
bot.launch().then(() => {
  console.log('‚úÖ –ë–æ—Ç –ü—Ö—É–∫–µ—Ç Go –∑–∞–ø—É—â–µ–Ω!');
  console.log('üì± –¢–µ—Å—Ç–∏—Ä—É–π: https://t.me/phuketgos_bot');
  console.log('üó∫Ô∏è Mini App: https://t.me/phuketgos_bot/app');
  console.log('');
  console.log('üìä –†–µ–∂–∏–º –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≥—Ä—É–ø–ø –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
  console.log('üí° –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≥—Ä—É–ø–ø:');
  console.log('   /getid - –ø–æ–ª—É—á–∏—Ç—å ID –≥—Ä—É–ø–ø—ã');
  console.log('   /stats - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É');
});

// üè• Health check —Å–µ—Ä–≤–µ—Ä –¥–ª—è Koyeb
const http = require('http');
const healthServer = http.createServer((req, res) => {
  if (req.url === '/health' || req.url === '/') {
    res.writeHead(200, { 'Content-Type': 'application/json' });
    res.end(JSON.stringify({ 
      status: 'ok', 
      bot: 'running',
      uptime: process.uptime(),
      timestamp: new Date().toISOString()
    }));
  } else {
    res.writeHead(404);
    res.end('Not Found');
  }
});

const PORT = process.env.PORT || 8000;
healthServer.listen(PORT, () => {
  console.log(`üè• Health check server running on port ${PORT}`);
});

// Graceful shutdown
process.once('SIGINT', () => {
  healthServer.close();
  bot.stop('SIGINT');
});
process.once('SIGTERM', () => {
  healthServer.close();
  bot.stop('SIGTERM');
});
