# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ö–Ω–æ–ø–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏

**–î–∞—Ç–∞**: 10 –Ω–æ—è–±—Ä—è 2025 –≥.  
**–ü—Ä–æ–±–ª–µ–º–∞**: –ë–æ—Ç –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –Ω–∞ —à–∞–≥–µ "–°–∫–æ–ª—å–∫–æ –≤–∑—Ä–æ—Å–ª—ã—Ö –ø–æ–µ–¥–µ—Ç?"  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üî¥ –°–∏–º–ø—Ç–æ–º—ã –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª –≤ Telegram:

```
üë• –®–∞–≥ 3/5: –°–∫–æ–ª—å–∫–æ –≤–∑—Ä–æ—Å–ª—ã—Ö –ø–æ–µ–¥–µ—Ç? (–æ—Ç 18 –ª–µ—Ç)
–í—ã–±–µ—Ä–∏—Ç–µ:

[1 üë§] [2 üë•] [3 üë•]
[4 üë•] [5+ üë•]
```

**–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ - –ù–ò–ß–ï–ì–û –ù–ï –ü–†–û–ò–°–•–û–î–ò–õ–û**

–ë–æ—Ç "–∑–∞–º–∏—Ä–∞–ª" –∏ –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–ª –¥–∏–∞–ª–æ–≥ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫

```javascript
// ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ë–´–õ–ò –í –ö–û–î–ï (—Å—Ç—Ä–æ–∫–∏ 1181-1206)
for (let i = 1; i <= 5; i++) {
  bot.action(`adults_${i}`, async (ctx) => {
    await ctx.answerCbQuery();
    sessions[userId].adults = i;
    // ...
  });
}
```

**–í—ã–≤–æ–¥**: –ö–æ–¥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –∏ –±—ã–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

```bash
curl "https://api.telegram.org/bot.../getWebhookInfo"
```

```json
{
  "url": "https://small-robinia-phukeo-8b5e1e16.koyeb.app/telegram-webhook",
  "pending_update_count": 0  ‚Üê Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
}
```

**–í—ã–≤–æ–¥**: Webhook —Ä–∞–±–æ—Ç–∞–ª, Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–ª –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: Express middleware

```javascript
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê –ù–ê–ô–î–ï–ù–ê!
const express = require('express');
const app = express();

// –ë—ã–ª —Ç–æ–ª—å–∫–æ app.use(express.json());
// –ù–û –û–¢–°–£–¢–°–¢–í–û–í–ê–õ urlencoded parser!

app.post('/telegram-webhook', (req, res) => {
  bot.handleUpdate(req.body, res);  // req.body –±—ã–ª undefined –∏–ª–∏ –Ω–µ–ø–æ–ª–Ω—ã–π!
});
```

**–ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê**:  
Express –Ω–µ –º–æ–≥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç Telegram —Å `callback_query`.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥

```javascript
// ‚úÖ –î–û (–Ω–µ–ø–æ–ª–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥)
app.use(express.json());

// ‚úÖ –ü–û–°–õ–ï (–ø–æ–ª–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥)
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```javascript
app.post(WEBHOOK_PATH, async (req, res) => {
  // –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  if (req.body?.callback_query) {
    console.log('üìû Callback query:', req.body.callback_query.data);
  }
  if (req.body?.message?.text) {
    console.log('üí¨ Message:', req.body.message.text);
  }
  
  try {
    await bot.handleUpdate(req.body, res);
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ update:', error);
    res.sendStatus(500);
  }
});
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–î–æ–±–∞–≤–ª–µ–Ω `try/catch` –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –≤ –±—É–¥—É—â–µ–º.

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: –Ω–∞–∂–∏–º–∞–µ—Ç "–•–æ—á—É –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å!"
2. **–ë–æ—Ç**: "üë§ –®–∞–≥ 1/5: –ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?"
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: "–ï–≤–≥–µ–Ω–∏–π"
4. **–ë–æ—Ç**: "üìÖ –®–∞–≥ 2/5: –ù–∞ –∫–∞–∫—É—é –¥–∞—Ç—É?"
5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: "12 –¥–µ–∫–∞–±—Ä—è"
6. **–ë–æ—Ç**: "üë• –®–∞–≥ 3/5: –°–∫–æ–ª—å–∫–æ –≤–∑—Ä–æ—Å–ª—ã—Ö?" + –∫–Ω–æ–ø–∫–∏
7. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: [–Ω–∞–∂–∏–º–∞–µ—Ç "2 üë•"] ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢!**
8. **–ë–æ—Ç**: "‚úÖ 2 –≤–∑—Ä–æ—Å–ª—ã—Ö\n\nüë∂ –®–∞–≥ 4/5: –°–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π?" + –∫–Ω–æ–ø–∫–∏
9. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: [–Ω–∞–∂–∏–º–∞–µ—Ç "–ù–µ—Ç –¥–µ—Ç–µ–π"] ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢!**
10. **–ë–æ—Ç**: "üì± –®–∞–≥ 5/5: –ö–∞–∫ —Å –≤–∞–º–∏ —Å–≤—è–∑–∞—Ç—å—Å—è?"
11. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: [–¥–µ–ª–∏—Ç—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º]
12. **–ë–æ—Ç**: "‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä—É!"

**–í–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞!** üéâ

---

## üéì –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ

### Webhook vs Polling —Ä–µ–∂–∏–º—ã

| –ê—Å–ø–µ–∫—Ç | Polling (–ª–æ–∫–∞–ª—å–Ω–æ) | Webhook (Koyeb) |
|--------|-------------------|-----------------|
| **–ü–∞—Ä—Å–∏–Ω–≥** | Telegraf –¥–µ–ª–∞–µ—Ç —Å–∞–º | Express –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å |
| **req.body** | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ï–ù |
| **Middleware** | –ù–µ –Ω—É–∂–µ–Ω | `express.json()` + `urlencoded()` |
| **Callback queries** | –†–∞–±–æ—Ç–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | –ù—É–∂–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ |

### –ë–µ–∑ `express.urlencoded()`:
```javascript
// Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
POST /telegram-webhook
Content-Type: application/json
{
  "callback_query": {
    "data": "adults_2",
    "from": { "id": 123 }
  }
}

// Express —á–∏—Ç–∞–µ—Ç:
req.body = {}  // ‚ùå –ü–£–°–¢–û–ô –û–ë–™–ï–ö–¢!

// bot.handleUpdate –ø–æ–ª—É—á–∞–µ—Ç:
undefined  // ‚ùå –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç!
```

### –° `express.urlencoded()`:
```javascript
// Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
POST /telegram-webhook
Content-Type: application/json
{
  "callback_query": {
    "data": "adults_2",
    "from": { "id": 123 }
  }
}

// Express —á–∏—Ç–∞–µ—Ç:
req.body = {
  callback_query: {
    data: "adults_2",
    from: { id: 123 }
  }
}  // ‚úÖ –ü–û–õ–ù–´–ô –û–ë–™–ï–ö–¢!

// bot.handleUpdate –ø–æ–ª—É—á–∞–µ—Ç:
{ callback_query: { data: "adults_2" } }  // ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç!
```

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–æ–±–ª–µ–º

–ï—Å–ª–∏ callback_query –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ webhook —Ä–µ–∂–∏–º–µ:

- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `app.use(express.json())`
- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `app.use(express.urlencoded({ extended: true }))`
- [ ] –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `console.log(req.body)`
- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `bot.handleUpdate(req.body)` –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- [ ] –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (`getWebhookInfo`)
- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Koyeb Dashboard ‚Üí Logs

---

## üîó –ö–æ–º–º–∏—Ç—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: `962b707`
```bash
git show 962b707
```

**–§–∞–π–ª—ã**:
- `bot/welcome-message.js` - –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| Webhook | ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω |
| Health check | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| Express middleware | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω |
| Callback queries | ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è |
| –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—à–∞–≥ 3/5) | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—à–∞–≥ 4/5) | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä—É | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

**–ë–û–¢ –ü–û–õ–ù–û–°–¢–¨–Æ –§–£–ù–ö–¶–ò–û–ù–ê–õ–ï–ù! üéâ**

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram: [@phuketgos_bot](https://t.me/phuketgos_bot)
2. –ö–æ–º–∞–Ω–¥–∞: `/start`
3. –ù–∞–∂–º–∏—Ç–µ: "üéüÔ∏è –•–æ—á—É –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å!"
4. –í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±–æ–π —Ç—É—Ä
5. –ü—Ä–æ–π–¥–∏—Ç–µ –≤—Å–µ 5 —à–∞–≥–æ–≤:
   - –ò–º—è (—Ç–µ–∫—Å—Ç)
   - –î–∞—Ç–∞ (—Ç–µ–∫—Å—Ç)
   - –í–∑—Ä–æ—Å–ª—ã–µ (–ö–ù–û–ü–ö–ò) ‚Üê **–≠–¢–û –ë–´–õ–û –°–õ–û–ú–ê–ù–û**
   - –î–µ—Ç–∏ (–ö–ù–û–ü–ö–ò) ‚Üê **–≠–¢–û –ë–´–õ–û –°–õ–û–ú–ê–ù–û**
   - –ö–æ–Ω—Ç–∞–∫—Ç (–∫–Ω–æ–ø–∫–∞ –∏–ª–∏ —Ç–µ–∫—Å—Ç)
6. –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –í–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏–π.

---

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞! ‚úÖ**
