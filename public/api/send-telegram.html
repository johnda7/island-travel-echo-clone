// API endpoint для GitHub Pages
// Файл: public/api/send-telegram.html

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Telegram Proxy API</title>
</head>
<body>
<script>
// Простой proxy через HTML страницу
window.addEventListener('message', async (event) => {
    // Проверяем origin для безопасности (разрешаем prod и localhost для dev)
    const allowedOrigins = ['https://phukeo.com', 'http://localhost:8080', 'http://localhost:3000'];
    if (!allowedOrigins.includes(event.origin)) {
        console.log('❌ Origin not allowed:', event.origin);
        return;
    }

    const { chat_id, text, requestId } = event.data;

    try {
        // ✅ НОВЫЙ ТОКЕН (старый отозван 24.11.2025 после взлома)
        const BOT_TOKEN = '8475227105:AAFWvuOuD-2vB0Ka7n9GowGbcjsWzqeL1N8';
        
        const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chat_id, text, parse_mode: 'HTML' })
        });

        const result = await response.json();
        
        // Отправляем результат обратно
        event.source.postMessage({
            requestId,
            result
        }, event.origin);

    } catch (error) {
        event.source.postMessage({
            requestId,
            error: error.message
        }, event.origin);
    }
});

// Сообщаем что готовы
window.parent.postMessage({ ready: true }, '*');
</script>
</body>
</html>
